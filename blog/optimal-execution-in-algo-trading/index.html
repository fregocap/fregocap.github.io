<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8" />
  <title>Algo Trading: The Optimal Execution Problem</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <!-- Slick Carousel --> 
  <link rel="stylesheet" href="http://capfab.io/plugins/slick/slick.css" />
  <link rel="stylesheet" href="http://capfab.io/plugins/slick/slick-theme.css" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="http://capfab.io/plugins/font-awesome/css/font-awesome.min.css" />
  <!-- Bootstrap -->
  <link rel="stylesheet" href="http://capfab.io/plugins/bootstrap/bootstrap.min.css" />
  <link rel="stylesheet" href="http://capfab.io/plugins/magnafic-popup/magnific-popup.css" />

  <!-- Stylesheets -->
  
  <link href="http://capfab.io/scss/style.min.css" rel="stylesheet" />

  <!--Favicon-->
  <link rel="shortcut icon" href="http://capfab.io/images/favicon.ico" type="image/x-icon" />
  <link rel="icon" href="http://capfab.io/images/favicon.png" type="image/x-icon" />
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-179028456-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-179028456-1');
  </script>
	
</head>

  <body>
    <nav class="navbar navbar-expand-lg fixed-top">
  <div class="container">
      <a href="http://capfab.io/" class="navbar-brand">
          <img src="http://capfab.io/images/site-navigation/logo.png" alt="site-logo">
      </a>
      <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#navbarCollapse">
          <span class="navbar-toggler-icon"></span>
          <span class="navbar-toggler-icon"></span>
          <span class="navbar-toggler-icon"></span>
      </button>
  
      <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
          <ul class="nav navbar-nav main-navigation">
              
              
                <li class="nav-item">
                  <a href="http://capfab.io/#home" class="nav-link ">Home</a>
                </li>
              
                <li class="nav-item">
                  <a href="http://capfab.io/#about" class="nav-link ">About</a>
                </li>
              
                <li class="nav-item">
                  <a href="http://capfab.io/#blog" class="nav-link ">Blog</a>
                </li>
              
                <li class="nav-item">
                  <a href="http://capfab.io/#contact" class="nav-link ">Contact</a>
                </li>
              
          </ul>
          <div class="navbar-nav">
              <a href="http://capfab.io/contact" class="hire_button">Let's Talk</a>
          </div>
      </div>
  </div>
</nav>

    <div id="content">
      

<header class="breadCrumb">
  <div class="container">
    <div class="row">
      <div class="col-lg-10 col-md-12 offset-lg-1 offset-md-0 text-center">
        <h3 class="breadCrumb__title">Algo Trading: The Optimal Execution Problem</h3>
        <nav aria-label="breadcrumb" class="d-flex justify-content-center">
          <ol class="breadcrumb align-items-center">
            <li class="breadcrumb-item"><a href=http://capfab.io/>Home</a></li>
            <li class="breadcrumb-item"><a href=http://capfab.io/blog>All Post</a></li>
            <li class="breadcrumb-item active" aria-current="page">Algo Trading: The Optimal Execution Problem</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
</header>

<section class="section singleBlog">
  <div class="svg-img">
      <img src=http://capfab.io/images/hero/figure-svg.svg alt="">
  </div>
  <div class="animate-shape">
      
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 600 600">
          <defs>
              <linearGradient id="d" x1="0.929" y1="0.111" x2="0.263" y2="0.935" gradientUnits="objectBoundingBox">
                  <stop offset="0" stop-color="#f1f6f9" />
                  <stop offset="1" stop-color="#f1f6f9" stop-opacity="0" />
              </linearGradient>
          </defs>
          <g data-name="blob-shape (3)">
              <path class="blob" fill="url(#d)"
                  d="M455.4 151.1c43.1 36.7 73.4 92.8 60.8 136.3-12.7 43.5-68.1 74.4-111.3 119.4-43.1 45-74 104.1-109.8 109-35.9 5-76.7-44.2-111.8-89.2-35.2-45-64.7-85.8-70.8-132.6-6-46.8 11.6-99.6 46.7-136.3 35.2-36.6 88-57.2 142.4-58.8 54.5-1.7 110.6 15.6 153.8 52.2z" />
          </g>
      </svg>
  </div>
  <div class="animate-pattern">
      <img src=http://capfab.io/images/service/background-pattern.svg alt="background-shape">
  </div>
  <div class="container">
      <div class="row">
          <div class="col-lg-12">
              <div class="singleBlog__feature">
                  <img src=http://capfab.io/images/single-blog/algorithmic-trading.jpg alt="feature-image">
              </div>
          </div>
      </div>
      <div class="row mt-5">
          <div class="col-lg-12">
              <div class="singleBlog__content">
                <h1 id="introduction">Introduction</h1>
<p>Algorithmic trading is omnipresent in the financial industry, where a form of automated trading
executes the orders and decides the amount of shares, the entry point and/or the exit point.
In the present blog post, we define and explore the problem of optimal execution in the context
of algorithmic trading.</p>
<h1 id="optimal-execution">Optimal Execution</h1>
<p>Let's imagine that you need to sell a large amount of shares $S_t$ at a certain time $t$ with
$P_t$. If the amount of shares that you would like to sell (or buy) is of the same order than
the amount of shares that are traded daily at your broker, then asking your broker to sell your
shares will have an impact on the price at which your shares will effectively be sold. The
question is then: what is the optimal strategy to sell an (potentially high) amount of shares
such that the overall price of the asset is minimally affected ?</p>
<p>The expected transactions costs are a joint effect of the market impact and the market risk.
One could consider that the evolution of the asset prices can be modeled by three terms:</p>
<p>$$
\begin{eqnarray}
\label{eqn:pricedynamics}
P_{t} = P_{t-1} +\theta S_{t} + \varepsilon_{t}
\end{eqnarray}
$$
where $P_{t}$ depends on the price at a previous instant, a linear price impact term
$\theta S_{t} (\theta&gt;0)$ that depends on the number of shares that are sold at a particular
time t and of a white noise $\varepsilon_{t} \left(\varepsilon \sim \text{WN}(0,\sigma_t^2)\right)$.
As usual, the expected value of the term $\varepsilon_{t}$ is
$\mathbb{E}\left[\varepsilon_t| P_{t-1},S_t\right]=0$.</p>
<p>The optimal execution could be cast as the minimization of a cost function, where a total
quantity of shares $S_{\text{tot}}$ is sold in a certain period. By defining each instant
$t\in \{1,2,\cdots,T \}$, the optimal execution takes the form:</p>
<p>$$
\begin{eqnarray}
&amp;&amp;\min_{S_{t}} \mathbb{E}\left(\sum_{t=1}^T P_t S_t\right) \nonumber \\<br>
&amp;&amp; \text{s.t.} \sum_{t=1}^T S_t = S_{\text{tot}} . \nonumber
\end{eqnarray}
$$
<a href="#references">Bertsimas &amp; Lo [1]</a> considered the transaction costs and optimal execution
in the particular case of the price dynamics provided by equation (\ref{eqn:pricedynamics}).
The solution that they obtained is particularly simple and elegant: $S_1=S_2=\cdots=S_T=S_\text{tot}/T$.
This is called Time-Weighted Average Price (TWAP) . Such algorithm is part of a class of algorithms
that are called impact driven algorithms, where big trading orders are sliced into smaller orders to
minimize the market impact.</p>
<h1 id="implementation-shortfall-algorithm">Implementation Shortfall Algorithm</h1>
<p>Implementation Shortfall (IS) corresponds to the difference between the price at which
the investor decides to trade and the average execution price that is achieved.
The aim of such IS algos is to minimize not only the market impact, but also to account for the
market risk.</p>
<p>We could consider such a case through the mathematical minimization of a utility function
that accounts for the expectation and variance of a wealth process (i.e. the revenue
upon completion of the trade).</p>
<p>By defining $x_t$ as the remaining quantity of the asset to buy (or sell) at time $t$,
we could then conclude that the utility function</p>
<p>$$
\begin{eqnarray}
\label{eqn:is_utility_function}
\mathbf{J}_{\lambda}(x_1,\cdots,x_t) = \mathbf{E}(x_1,\cdots,x_t)+\lambda \mathbf{V}(x_1,\cdots,x_t)
\end{eqnarray}
$$
defines a trading strategy that minimizes the expected market costs for a given
risk aversion $\lambda$. For a particular price dynamics of the type given by (\ref{eqn:pricedynamics}),
the two terms in (\ref{eqn:is_utility_function}) are given by:</p>
<p>$$
\begin{eqnarray}
\mathbf{E}(x_t)&amp;=&amp; S_0 + \theta \sum_{t=1}^T \left(x_t -x_{t+1}\right)^2 \nonumber \\\<br>
\mathbf{V}(x_t)&amp;=&amp; \sum_{t=1}^T x_t^2 \sigma_t^2 \nonumber
\end{eqnarray}
$$
Here, $\sigma_t$ comes from the variance of the white noise term $\varepsilon_t$. To find the
global minimum (see <a href="#references">[3]</a>) we need to find the $x_t$ that respects $\partial \mathbf{J}/\partial x_t=0$.
The partial derivative of $\mathbf{J}_{\lambda}$ with respect to $x_t$ is:</p>
<p>$$
\begin{eqnarray}
\frac{\partial \mathbf{J}}{\partial x_t} = -2 \theta \left(x_{t-1} - x_t \right)+2\theta \left(x_t - x_{t+1} \right)+2 \lambda \sigma_t^2 x_t \nonumber
\end{eqnarray}
$$</p>
<p>which leads to the following recurrent equation:<br>
$$
\left(2+\lambda\frac{\sigma_t^2}{\theta} \right) x_t - x_{t-1} = x_{t+1}
$$
under the constraint that at instant zero $x_0=1$ and $x_{T+1} =0$ the optimal trading curve takes the form of the Figure 1.</p>
<p><img src="../../images/allpost/optimal_trading_curve50.png" alt=""></p>
<p><em>Figure 1. Such curve represents the percentage of shares that are sold through time when minimizing the effect of market impact and market risk.
The  trajacetory with $\lambda=0$ is the naive strategy that does not account for the variance. The risk averse trader would rather chose to sell
quickly its shares.</em></p>
<p>There is therefore in this particular framework first developped by <a href="#references">Almgren and Chriss [2]</a> an explicit solution to the optimal
execution problem that takes into account the risk-reward tradeoff through the parameter $\lambda$. As one can see in the Figure 1,
the risk averse trader choses to sell quickly to reduce the exposure to volatility risk, even though the trading costs might be higher.</p>
<h1 id="reinforcement-learning">Reinforcement Learning</h1>
<p>A clever way to think about the financial markets is through the context of reinforcement learning.
The aim of reinforcement learning is to learn a policy $\pi \in \Pi$ that controls the system with states
$s \in \mathcal{S}$ through the actions $x \in \mathcal{X}$ guided by the maximization of the total
expected discounted rewards:</p>
<p>$$
\mathcal{R} = \sum_{t=1}^{T} \gamma^{t-1} R(s_t,x_t)
$$</p>
<p>based on some reward function $R(s,x)$. The discount factor $\gamma$ is typically set to 1, because
of the short time period considered in the problem of optimal execution.
Several assumptions could be made about the actions, states and rewards for the particular problem of
optimal execution. In <a href="#references">Brian Ning et al [4]</a>, through  a system of reinforcement learning
they are able to outperfom the TWAP algorithm previously discussed.</p>
<p>The state space contains the information regarding the orders of the brokers at each instant, as well as
any previous information. The typically assumption that is made is that the mapping $(s_t,x_t)\longmapsto s_{t+1}$
is Markovian. The two states that are central in the optimal execution problem are (i) the current time
$t$ and (ii) the remaining shares $x_t$.</p>
<p>In the optimal execution problem, there is only one action, which it is to sell a certain amount of shares
at a certain time. Therefore, the allowed actions is to be able to sell $x_t \in [0, q_t]$. One could also
restrict the amount of shares to be sold to be an integer.</p>
<p>The rewards are a bit more difficult to define and are not universally well defined in a reinforcement
learning context. At each period, the system gets a reward (positive or negative) to trade a certain
amount of shares. To account for the transaction costs and the effect of impact risk, there is a typical
penalty term that is added to the overall reward function. In <a href="#references">Brian Ning et al [4]</a>, they
consider a quadratic term in $x_t$ as the penalty term that accounts for the impact risk. Their reward
function within an intra-period timestep $[t_{i},t_{i+1})$ is given by:</p>
<p>$$
R_{i} = q_t \left(p_{t,i} - p_{t,i+1} \right) - \alpha x_t^2
$$</p>
<p>where $\alpha$ represents a constant parameter, and $p_{t,i}$ the price at time $t_{i}$.</p>
<h1 id="whats-next">What's Next</h1>
<p>Brokers are almost all electronic and automated. In that context, the optimal execution problem is
central to provide faire execution prices to the market players. In the present blog post, we discuss
the core of the problem in a very simplistic manner.</p>
<p>We have seen that we could take the perspective of minimization of a market impact cost function,
through the TWAP algo, or also take into account the market risk through the implementation
shortfall algorithm.</p>
<p>The tendency in the industry is to consider less the modelization of the processes taking place and
go more into data driven models.</p>
<p>Reinforcement learning, and in particular deep-Q learning, have been explored in the literature and
represent in my opinion the future of the financial industry. We will explore in future blog posts
the advanced machine learning techniques that are being used in algorithmic trading.</p>
<hr>
<p>If you would like to cite the present content, please use:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Bash" data-lang="Bash">
 @article<span style="color:#f92672">{</span>fabio2020optimalexecution,
   title   <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Algo Trading: The Optimal Execution Problem&#34;</span>,
   author  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Capela, Fabio&#34;</span>,
   journal <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;capfab.io/blog&#34;</span>,
   year    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2020&#34;</span>,
   url     <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://capfab.io/blog/optimal-execution-in-algo-trading&#34;</span>
 <span style="color:#f92672">}</span>

</code></pre></div><hr>
<h2 id="references">References</h2>
<p>[1] Dimitris Bertsimas and Andrew W Lo. Optimal control of execution costs. <em>Journal of Financial markets</em>, 1(1):1-50, 1998<br>
[2] Robert Almgren and Neil Chriss. Optimal execution of portfolio transactions. <em>Journal of Risk, 3:5-40, 2001.</em><br>
[3] $\mathbf{J}$ has a global minimum, because all eigenvalues of $\mathbf{J}_{\lambda}$ are clearly
positive for the trivial case of $\theta=0$. Such conclusion can be extended by continuity arguments of the
eigenvalues.<br>
[4] Brian Ning, Franco Ho Ting Lin, Sebastian Jaimungal, <em>Double Deep Q-Learning for Optimal Execution</em>
<a href="https://arxiv.org/pdf/1812.06600.pdf">https://arxiv.org/pdf/1812.06600</a></p>

		<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "capfabio" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
              </div>
          </div>
      </div>
  </div>
</section>


    </div>
    <section class="contact" id="contact">
  <div class="contact__background_shape">
      <svg viewBox="0 0 1920 79">
          <path d="M0 0h1920v79L0 0z" data-name="Path 1450" />
      </svg>
  </div>
  <div class="container">
      <div class="row">
          <div class="col-lg-12">
              <div class="contact__cta">
                  <div class="shape-1">
                      <svg xmlns="http://www.w3.org/2000/svg" width="357" height="315.029" viewBox="0 0 357 315.029">
                          <path data-name="Path 1449" d="M76.1-157.222C91.746-135.8 87.2-94.273 99.993-61.945c12.7 32.328 42.661 55.459 39.248 73.282-3.318 17.823-40.007 30.337-65.6 43.325-25.5 12.988-39.912 26.545-60.01 42.566-20.1 16.116-46.074 34.6-63.328 27.682-17.349-6.921-25.976-39.153-59.915-59.82s-93.1-29.768-105.325-51.478 22.373-56.028 43.609-93.949c21.331-37.921 29.2-79.35 53.563-96.793 24.459-17.444 65.414-10.9 103.9-6.921 38.396 3.982 74.326 5.404 89.965 26.829z" transform="translate(217.489 188.626)"/>
                      </svg>
                  </div>
                  <div class="shape-2">
                      <svg xmlns="http://www.w3.org/2000/svg" width="357" height="315.029" viewBox="0 0 357 315.029">
                          <path data-name="Path 1449" d="M76.1-157.222C91.746-135.8 87.2-94.273 99.993-61.945c12.7 32.328 42.661 55.459 39.248 73.282-3.318 17.823-40.007 30.337-65.6 43.325-25.5 12.988-39.912 26.545-60.01 42.566-20.1 16.116-46.074 34.6-63.328 27.682-17.349-6.921-25.976-39.153-59.915-59.82s-93.1-29.768-105.325-51.478 22.373-56.028 43.609-93.949c21.331-37.921 29.2-79.35 53.563-96.793 24.459-17.444 65.414-10.9 103.9-6.921 38.396 3.982 74.326 5.404 89.965 26.829z" transform="translate(217.489 188.626)"/>
                      </svg>
                  </div>
                  <div class="contact__cta_content">
                      <span>Contact me</span>
                      <h1>Let's get in touch</h1>
                  </div>
                  <div class="contact__cta_action">
                      <a href="http://capfab.io/contact">Message Me</a>
                  </div>
              </div>
          </div>
      </div>
      <div class="row contact__widget">
          <div class="col-lg-4">
              <div class="contact__widget_logo">
                  <img src="http://capfab.io/images/contact/widget-logo.png" alt="widget-logo">
              </div>
          </div>
          <div class="col-lg-4">
              <div class="contact__widget_sitemap">
                  <h3>Sitemap</h3>
                  <ul>
                      
                      
                        <li><a href="http://capfab.io/about">About me</a></li>
                      
                        <li><a href="http://capfab.io/">Privacy &amp; Policy</a></li>
                      
                        <li><a href="http://capfab.io/">Latest Article</a></li>
                      
                  </ul>
              </div>
          </div>
          <div class="col-lg-4">
              <div class="contact__widget_address">
                  <h3>Address</h3>
                  
                  <ul>
                      <li><a href="tel:6006LE"><i class="fa fa-phone"></i>6006LE</a></li> 
                      <li><a href="mailto:capela625@gmail.com"><i class="fa fa-envelope"></i>capela625@gmail.com</a></li>
                      <li><p><i class="fa fa-map-marker"></i>Solar System, Earth</p></li>
                  </ul>
              </div>
          </div>
      </div>
      <div class="row contact__footer">
          <div class="col-lg-6">
              <div class="contact__footer_copy">
                  <p>All rights reserved copyright © capfab.io 2020</p>
              </div>
          </div>
          <div class="col-lg-6">
              <div class="contact__footer_social">
                  <ul>
                      <li><a href="https://www.linkedin.com/in/fabio-capela-phd-3a19925b/"><i class="fa fa-linkedin-square"></i></a></li>
                      <li><a href="https://github.com/fregocap"><i class="fa fa-github-square"></i></a></li>
                      <li><a href="https://www.instagram.com/capela625/"><i class="fa fa-instagram"></i></a></li>
                  </ul>
              </div>
          </div>
      </div>
  </div>
</section>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD0eifSMvIhlNwZ9gEgSGU4kHamEbVcMj4&libraries=geometry"></script>
<script src="http://capfab.io/plugins/jQuery/jquery.min.js"></script>
<script src="http://capfab.io/plugins/bootstrap/bootstrap.min.js"></script>
<script src="http://capfab.io/plugins/slick/slick.min.js"></script>
<script src="http://capfab.io/plugins/slick/slick.min.js"></script>
<script src="http://capfab.io/plugins/waypoint/jquery.waypoints.min.js"></script>
<script src="http://capfab.io/plugins/magnafic-popup/jquery.magnific-popup.min.js"></script>
<script src="http://capfab.io/plugins/tweenmax/TweenMax.min.js"></script>
<script src="http://capfab.io/plugins/masonry/masonry.min.js"></script>

<script src="http://capfab.io/js/form-handler.min.js"></script>

<script src="http://capfab.io/js/script.min.js"></script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
  });
  MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });

  MathJax.Hub.Config({
  
  TeX: { equationNumbers: { autoNumber: "AMS" } }
  });
</script>

  </body>
</html>
